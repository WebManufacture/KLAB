<!DOCTYPE html>
<html>
	<head>
		<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
		<link type='text/css' rel='stylesheet' href="http://Services.web-manufacture.net/Styles/System.default.css" />
		<script type="text/javascript" src="http://Services.web-manufacture.net/Base/v1.3/Utils.js"></script>
		<script type="text/javascript" src="http://Services.web-manufacture.net/Base/v1.3/DOM.js"></script>
		<script type="text/javascript" src="http://Services.web-manufacture.net/Base/v1.3/Url.js"></script>
		<script type="text/javascript" src="http://Services.web-manufacture.net/Base/v1.3/Node.js"></script>
		<title>Конфигурация сервера</title>
		
		<script key="TextEditor" type="text/javascript">
			
			Notify = {};
			
			Notify.Show = function (message) {
				var nf = DOM("#Notify");
				var ev = nf.div(".event.first", (new Date()).formatTime() + " " + message);
				nf.show();
				nf.ins(ev);
				Notify.setTimeout();
			};
			
			Notify.Error = function (error) {
				var nf = DOM("#Notify");
				var ev = nf.div(".event.error.first", (new Date()).formatTime() + " " + error);
				nf.show();
				nf.ins(ev);
				Notify.setTimeout();
			};
			
			Notify.setTimeout = function () {
				if (Notify.timeout) {
					window.clearTimeout(Notify.timeout);
				}
				Notify.timeout = window.setTimeout(Notify.clearFirst, 3000);
			};
			
			Notify.clearFirst = function () {
				DOM.all("#Notify .event.first").del(".first");
			};
			
			function XH() {
				var xmlhttp;
				xmlhttp = new XMLHttpRequest();
				return xmlhttp;
			};
			
			ConfManager = {};
			
			ConfManager.Init = function(){
				Server = new NodeServer();
				ConfManager.ShowLogs();
				ConfManager.ShowConfigs();
			};
			
			ConfManager.ShowLogs = function(){
				var url = new Url("/");
				url.host = url.host.replace(url.hostname, "logs." + url.hostname);
				url.hostname = "logs." + url.hostname;
				Server.get(url + "", ConfManager.LogsLoaded);
			};
			
			ConfManager.ShowConfigs = function(){
				var url = new Url("/");
				url.host = url.host.replace(url.hostname, "config." + url.hostname);
				url.hostname = "config." + url.hostname;
				Server.get(url + "", ConfManager.ConfigsLoaded);
			};
			
			ConfManager.LogsLoaded = function(result, status){
				if (status == 200){
					var logs = JSON.parse(result);
					for (var i = 0; i < logs.length; i++){
						var log = logs[i];	
						DOM("#Logs").div("." + log.type, log.message);
					}
					
				}
				else{
					Notify.Error("Logs not loaded: " + status);	
				}				
			};
			
			ConfManager.ConfigsLoaded = function(result, status){
				if (status == 200){
					DOM("#Config").add(" " + result);
				}
				else{
					Notify.Error("Logs not loaded: " + status);	
				}		
			};
			
			WS.DOMload(ConfManager.Init);
			
		</script><style type="text/css">
			body{
				background-color: #fff;  				
			} 
			
			.block {
				background: rgba(255, 255, 255, 0.6);
				border: solid 1px #ccc;
				border-radius: 10px;
				padding: 10px;
				width: 100%;
				height: auto;
			}
			
			.block h2{
				font-size:20px;
				margin: 2px;
			}
			
			
			.header.toolbar .menuitem.disabled{
				background-color: red;	
			}
			
			#Notify{
				background-color: white;
				border: 1px solid navy;
				border-radius: 10px 10px 10px 10px;
				cursor: default;
				font-size: 16px;
				height: 300px;
				text-align: left;
				width: 8%;
				opacity: 0.5;
				position: fixed;
				top: 1%;
				right: 1%;
				z-index: 20;
				padding: 7px;
				font-size: 12px;
				overflow: hidden;
			}
			
			#Notify .event{
				color: #333;
			}
			
			#Notify .event.first{
				background-color:yellow;
			}
			
			#Notify .event.error{
				color: red;
			}
			
			
		</style>
	</head>
	<body>
		<div id="Notify">
		</div>
		<div class="block" id="Logs"><h2>
				Логи
			</h2></div>
			
		<div class="block" id="Config">
			<h2>
				Конфиг
			</h2>
		</div>
		<div onclick="this.hide();" class="invisible" id="hkHint">
			<h2>
				Список новых фишек</h2>
			<hr>
			<ul>
				<li>Автозакрывание тагов</li>
				<li>Подсветка похожих выделенных слов</li>
				<li>Улучшено форматирование JS</li>
				<li>Поиск и замена</li>
				<li>Что-то еще, не помню что :)</li>
				<li>Исправлен глюк с выделением</li>
				<li>Исправлен глюк с длинной строкой</li>
				<li>Исправлен глюк с отменой</li>
				<li>Исправлен глюк с позицией воода</li>
				<li>Исправлен глюк с форматированием JS</li>
			</ul>
			<h2>
				Список горячих клавиш</h2>
			(работает только в Firefox)
			<hr>
			<div class="hot-key">
				<span class="key-combination">Shift + Tab </span>Переформатировать выделенный текст (отступы)
			</div>
			<div class="hot-key">
				<span class="key-combination">Ctrl + S </span>Сохранить
			</div>
			<div class="hot-key">
				<span class="key-combination">Ctrl + F, Ctrl + S, Ctrl + R </span>Найти текст\ (Следующий) \ (Предыдущий)
			</div>
			<div class="hot-key">
				<span class="key-combination">Ctrl + A </span>Выделить весь файл
			</div>
			<div class="hot-key">
				<span class="key-combination">Ctrl + X, Ctrl + C, Ctrl + V </span>Буфер обмена
			</div>
			<div class="hot-key">
				<span class="key-combination">Ctrl + Z, Ctrl + Shift + Z </span>Отменить\Вернуть
			</div>
			<div class="hot-key">
				<span class="key-combination">Ctrl + Пробел </span>Автодополнение (в доработке)
			</div>
		</div>
		
		<include url="http://services.web-manufacture.net/ui/Toolbars.htm"></include>
		
		<div class="header toolbar" id="Toolbar">
			<div onclick="ConfManager.ShowLogs();" icon="http://cdn1.iconfinder.com/data/icons//Human_O2_Grunge_by_Tutsii/32/text-x-log.png" tooltip="Логи" class="menuitem save">
			</div>
			<div onclick="ConfManager.ShowConfigs();" icon="http://cdn2.iconfinder.com/data/icons/stilllife/48x48/apps/gnome-server-config.png" tooltip="Конфиги" class="menuitem save">
			</div>
		</div>
		
		
	</body>
</html>
