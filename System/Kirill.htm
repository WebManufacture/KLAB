<!DOCTYPE html>
<html>
    <head>
	<script type="text/javascript" src="Utils.js"></script>
	<script type="text/javascript" src="DOM.js"></script>
	<script type="text/javascript" src="Url.js"></script>
	<script type="text/javascript" src="Ajax.js"></script>
	<script type="text/javascript" src="Jasp.js"></script>
	<link type='text/css' rel='stylesheet' href="System.default.css"/>
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
	<title>Добавление элементов</title>
	<style type="text/css">
	    body{
		background-color: #eee;
		padding: 10px;
	    }
	    .adds{
		left: 400px;
		position: fixed;
	    }
	    .elements{
		display: inline;
	    }
	    .panel{
		display: inline;
		border: 1px solid red;
	    }
	    #panels{
		position: absolute;
	    }
	    .block{
		display: inline;
	    }
	</style>
	<script type="text/javascript">
	    var papa='';
	    var oldname = '';
	    function init(){
		panelElement('autocomplete-source-js.htm');
	    }
	    function panelElement(url){
		DOM.all('.prew').del();
		var param=ax.Get(url);
		var elemenaAll = param.all(".a-item");
		var body=DOM('#adds');
		for (var i = 0; i<elemenaAll.length; i++){
		    mass=[elemenaAll[i].get('@name'),elemenaAll[i].innerHTML];
		    prew(mass);
		}
	    }
	    function prew(perem){
		var prew = DOM('#adds').div('.prew');
		for (var i = 0; i<perem.length; i++){
		    if (i == 0){
			divs(prew,perem[i],'names');
		    }
		    else {
			divs(prew,perem[i],'text');
		    }
		}
	    }
	    function divs(prew,perem,clas){
		var name = prew.div('.block.'+clas);
		name.add('$'+perem+' ');
		name.add('@title','Нажмите для редактирования');
		name.onclick=clik;
	    }
	    function clik(){
		contentDEL();
		this.add('@contenteditable', true);
		this.add('.activ');
		panels(this.offsetTop);
		
		
	    }
	    function panels(top){
		var panels=DOM.get('#panels');
		panels.style.top = top+'px';
		panels.style.left = '230px';
		panels.del('.invisible');
		DOM.get('#save').onclick = saved;
		DOM.get('#del').onclick = delet;
	    }
	    function delet(){
		alert(oldname)
		AJ.Del('autocomplete-source-js.htm', '.a-item[name^="'+oldname+'"]');
		oldname='';
		return true;
	    }
	    function saved(){
		var print = papa.get('.text');
		alert(print.innerHTML);
		papa='';
	    }
	    function contentDEL(){
		var activ=DOM.get('.activ');
		if (activ != null){
		    activ.set('@contenteditable', 'false');
		    activ.del('.activ');
		    return true;
		}
	    }
	    function addElement(event){
		var name=DOM.get('#name').value;
		var text=DOM.get('#text').value;
		if (name!='' && text!=''){
		    AJ.Add('autocomplete-source-js.htm', null, "\n<div class='a-item' name='"+name+"'>"+text+"</div>");
		}
		panelElement('autocomplete-source-js.htm');
	    }
	    
	    WS.DOMload(init);
	</script>	
    </head>
    <body>
	<div class="adds">
	    Имя<input id='name' type="text" name="name" value=""/>
	    <br/>
	    Тело<input id='text' type="text" name="text" value=""/>
	    <br/>
	    <input id="button" onclick='addElement();' type="button" value="Добавить элемент"/>
	</div>
	<div id='panels' class="invisible"><div id='save' class='panel'>Сохранить</div><div id='del' class='panel'>Удалить</div></div>
	<div id='adds'></div>
    </body>
</html>